<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
<div class="container content-body" xmlns:th="http://www.thymeleaf.org" th:fragment="html">
  <script>
    $(function () {
      let bloglist = new Vue({
        el: "#workingArea",
        mixins:[mixin_auth],
        data() {
          return {
            uri: 'api/posts',
            auth_uri: 'auth/user',
            pagination: {
              current: 0,
              isHasContent: false,
              isHasNext: false,
              isHasPrevious: false,
              navigatePageNums: [],
              navigatePages: 0,
              totalPages: 0
            },
            posts: [],
            postCondition: false,
          }
        },
        mounted: function () {
          this.load(1)
          console.log(this.posts)
        },
        methods: {
          load: function (page) {
            let url = this.uri
            axios.get(`${url}?start=${page}&size=5`).then(function (response) {
              console.log(response.data)
              bloglist.posts = response.data.content
              bloglist.pagination = response.data
              bloglist.$set(bloglist, 'postCondition', true)
              //console.log(this.pagination)
            });
            this.getuser()

          },
          formDate: function (value) {
            if (value === null) {
              return ""
            }
            let formatString = 'YYYY-MM-DD HH:mm:ss'
            return moment(value).format(formatString)
          },
          bodyAbbr: function (body) {
            let cutLength = 300
            if (body.length > cutLength) {
              return body.substring(0, cutLength) + '...'
            }
            return body
          },
          jump: function (page) {
            jump(page, bloglist)
          },
          jumpByNumber: function (page) {
            jumpByNumber(page, bloglist)
          }
        }
      })
    })
  </script>


  <div class="row">

    <main class="col-sm-8 ">

      <article class="post post-58">
        <div v-for="ps in posts">
          <header class="entry-header">
            <h1 class="entry-title">
              <a :href="'detail?pid=' + ps.id">{{ps.title}}</a>
            </h1>
            <div class="entry-meta">
              <!--              todo: category, comments with jump link, reads-->
              <span class="post-category"><a href="#">#category</a></span>
              <span class="post-date"><a href="#">{{formDate(ps.createdDate)}}</a></span>
              <span class="post-author"><a href="#">{{ps.userName}}</a></span>
              <span class="comments-link"><a :href="'detail?pid=' + ps.id">#0 comments</a></span>
              <span class="views-count"><a :href="'detail?pid=' + ps.id">#0 reads</a></span>
            </div>
          </header>
          <div class="entry-content clearfix">
            <p v-html="bodyAbbr(marked(ps.body))"></p>

            <div class="read-more cl-effect-14">
              <a :href="'detail?pid=' + ps.id">Continue <span class="meta-nav">→</span></a>
            </div>
          </div>

          <!--          <h2 class="blog-post-title"><a :href="'detail?pid=' + ps.id">{{ps.title}}</a></h2>-->
          <!--          <p class="blog-post-meta">{{formDate(ps.createdDate)}} created by {{ps.userName}}</p>-->

          <!--          <div v-html="bodyAbbr(marked(ps.body))"></div>-->

        </div>
      </article>
      <ul class="text-center pagination ">
        <li :class="{disabled: !pagination.isHasPrevious}">
          <a href="#nowhere" @click="jump('first')">«</a>
        </li>
        <li :class="{ disabled: !pagination.isHasPrevious }">
          <a href="#nowhere" @click="jump('pre')">‹</a>
        </li>

        <li v-for="i in pagination.navigatePageNums">
          <a href="#nowhere" v-on:click="jumpByNumber(i)">
            {{i}}
          </a>
        </li>

        <li :class="{ disabled: !pagination.isHasNext }">
          <a href="#nowhere" @click="jump('next')">›</a>
        </li>
        <li :class="{ disabled: !pagination.isHasNext }">
          <a href="#nowhere" @click="jump('last')">»</a>
        </li>
      </ul>
    </main><!-- /.blog-main -->

    <aside class="col-md-4">

      <div v-if="user.isAdmin" class="sidebar-module">
<!--        <a type="button" class="btn btn-default btn-lg" href="/admin">-->
<!--          <span class="glyphicon glyphicon-open"></span>Admin Page-->
<!--        </a>-->
        <a type="button" class="btn btn-default btn-lg" :href="'admin'">
          <span class="glyphicon glyphicon-console"></span>Admin
        </a>
      </div>

    </aside>


    <div th:replace="include/aside::html"></div>
  </div><!-- /.blog-sidebar -->
</div><!-- /.row -->



